(function(){var _1;var _2;var _3=function(_4,_5){this.loader=_4;this.rootEl=document.getElementById(_5);this.rootEl.className+=" ih_loader";this.Percent=0;this.LoadedSize=0;this.TotalSize=0;this.LoadedFilesCount=0;this.TotalFilesCount=0;this.StatusText="Loading&hellip;";};_3.prototype={Render:function(){var _6=this.StatusText;if(this.LoadedSize>0&&this.TotalSize>0){_6+=" ("+this._FormatSize(this.LoadedSize)+" of "+this._FormatSize(this.TotalSize)+")";}if(this.LoadedFilesCount>0&&this.TotalFilesCount>0){_6+=" ("+this.LoadedFilesCount+" of "+this.TotalFilesCount+" files)";}this.rootEl.innerHTML="<div class=\"ih_loader_container\">"+"<div class=\"status\">"+_6+"</div>"+"<div class=\"progress\"><div style=\"width: "+Math.min(100,this.Percent)+"%;\"></div></div>"+"</div>";},Destroy:function(){this.rootEl.innerHTML="";this.rootEl.className=this.rootEl.className.replace("ih_loader","");},UpdateStatusText:function(_7){this.StatusText=_7;this.Render();},_SizeRound:function(_8,_9){_9=_9||2;var _a=Math.pow(10,_9);var _b=Math.round(_8*_a)/_a;_b=_b.toString();if(_b.indexOf(".")===-1){_b+=".";}var _c=/[0-9]+\.([0-9]*)/.exec(_b);if(_c!==null&&_c[1].length<_9){for(var i=_c[1].length;i<_9;i++){_b+="0";}}return _b;},_FormatSize:function(_d){_d=parseFloat(_d);if(_d>=1048576){return this._SizeRound(_d/1048576)+" Mb";}if(_d>=1024){return this._SizeRound(_d/1024)+" Kb";}return _d+" Bytes";}};var _e=function(_f,_10){this.Url=_f;this.Method=_10?_10.toUpperCase():"GET";this.IsLoaded=false;this.Data=null;this.StatusData={LastModified:null,LoadedLength:0,TotalLength:0};this.onload=null;this.onprogress=null;var _11=/\.([0-9a-z]+)(?:[\?#]|$)/i.exec(_f);this.FileExtension=_11!==null?_11[1]:null;};_e._CorsSupport=typeof window.XMLHttpRequest!=="undefined"&&"withCredentials" in new XMLHttpRequest();_e.prototype={_HaveUrlCors:function(){var _12=window.location.port==""?"":":"+window.location.port;var _13=window.location.protocol+"//"+window.location.hostname+_12+"/";return this.Url.indexOf(_13)!==0;},Load:function(){if(!this._HaveUrlCors()||_e._CorsSupport){this.LoadByXhr();}else{if(this.Method==="HEAD"){this.Data="";this.IsLoaded=true;var _14=this;setTimeout(function(){if(typeof _14.onload==="function"){_14.onload(_14.Data,"");}});}else{switch(this.FileExtension){case "js":this.LoadByScriptElement();break;case "css":this.LoadByLinkElement();break;default:throw new Error("Cannot load file `"+this.Url+"` with out CORS support.");break;}}}},LoadByScriptElement:function(){var _15=this;var _16=document.createElement("script");_16.async=false;_16.src=this.Url;_16.onload=_16.onerror=function(){if(_15.IsLoaded){return;}_15.Data="";_15.IsLoaded=true;if(typeof _15.onload==="function"){_15.onload(_15.Data,"");}};_16.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){setTimeout(function(){if(_15.IsLoaded){return;}_15.IsLoaded=true;_15.Data="";if(typeof _15.onload==="function"){_15.onload(_15.Data,"");}});this.onreadystatechange=null;}};document.getElementsByTagName("head")[0].appendChild(_16);},LoadByLinkElement:function(){var _17=document.createElement("link");_17.rel="stylesheet";_17.type="text/css";_17.href=this.Url;document.getElementsByTagName("head")[0].appendChild(_17);var _18="sheet" in _17?"sheet":"styleSheet";var _19="sheet" in _17?"cssRules":"rules";var _1a=this;var _1b=10000;var _1c=setInterval(function(){if(_17&&_17[_18]){_1a.Data="";_1a.IsLoaded=true;clearInterval(_1c);if(typeof _1a.onload==="function"){_1a.onload(_1a.Data,"");}}else{_1b-=10;if(_1b<0){clearInterval(_1c);if(typeof _1a.onload==="function"){_1a.onload(_1a.Data,"Error");}}}},10);},LoadByXhr:function(){var _1d=this;var _1e=this._GetHttpRequest();_1e.onreadystatechange=function(_1f){var _20=_1d.Method==="HEAD"?2:4;if(this.readyState!==_20){return;}if(this.status===200){_1d.IsLoaded=true;_1d.Data=this.responseText;}try{var _21=_1e.getResponseHeader("content-length");}catch(e){_21=0;}if(_21!==null){_1d.StatusData.TotalLength=parseInt(_21);_1d.StatusData.LoadedLength=parseInt(_21);}_1d.StatusData.LastModified=_1e.getResponseHeader("last-modified")||null;if(typeof _1d.onprogress==="function"){_1d.onprogress();}if(_1d.IsLoaded&&typeof _1d.onload==="function"){_1d.onload(_1d.Data,this.status+": "+this.statusText);}};_1e.onprogress=function(_22){_1d.StatusData.LoadedLength=_22.loaded;if(typeof _1d.onprogress==="function"){_1d.onprogress();}};_1e.onerror=function(_23){_e._CorsSupport=false;_1d.Load();};_1e.open(this.Method,this.Url,true);_1e.send();},_GetHttpRequest:function(){if(window.XMLHttpRequest){return new XMLHttpRequest();}else{if(window.ActiveXObject){return new ActiveXObject("MsXml2.XmlHttp");}}}};var _24=function(_25,_26){this._UrlList=_25;this._Method=_26||null;this.IsLoaded=false;this.Items=[];this._HasError=false;this.onload=null;this.onerror=null;this.onloadall=null;this.onprogress=null;this._Init();};_24.prototype={_Init:function(){var _27=this;for(var i=0,l=this._UrlList.length;i<l;i++){var _28=this._UrlList[i];var _29=new _e(_28,this._Method);_29.onload=function(_2a,_2b){if(_2a===null){_27._ErrorItemHandler(_2b);return;}_27._LoadItemHandler();};_29.onprogress=function(){_27._ProcessItemHandler();};this.Items.push(_29);}},_ErrorItemHandler:function(_2c){this._HasError=true;if(typeof this.onerror==="function"){this.onerror(this,_2c);}},_LoadItemHandler:function(){if(this._HasError){return;}if(typeof this.onload==="function"){this.onload(this);}var _2d=true;for(var i=0,l=this.Items.length;i<l;i++){_2d=_2d&&this.Items[i].IsLoaded;}if(!this.IsLoaded&&_2d===true){this.IsLoaded=true;if(typeof this.onloadall==="function"){this.onloadall(this);}}},_ProcessItemHandler:function(){if(this._HasError){return;}if(typeof this.onprogress==="function"){this.onprogress(this);}},Load:function(){for(var i=0,l=this.Items.length;i<l;i++){this.Items[i].Load();}}};var _2e=function(_2f){this.BasePath=window.location.href.replace(window.location.hash,"").replace(/[^\/]+?$/,"");this.BasePath=_2f.BasePath=_2f.BasePath?this.GetFolderUrl(_2f.BasePath):this.BasePath;this.Settings=_2f;this.ThemeName=_2f.ThemeName=_2f.ThemeName||this.DEFAULT_THEME;this.IconsSize=_2f.IconsSize=_2f.IconsSize||this.DEFAULT_ICONS_SIZE;this.NoCache=_2f.NoCache=_2f.NoCache||false;this.ThemesPath=_2f.ThemesPath=this.GetFolderUrl(_2f.ThemesPath||"themes");_2f.FileIconsPath=this.GetFolderUrl(_2f.FileIconsPath||"icons");_2f.MsOfficeTemplatesPath=this.GetFolderUrl(_2f.MsOfficeTemplatesPath||"templates");_2f.PluginsPath=this.GetFolderUrl(_2f.PluginsPath||"plugins");_2f.Platform=_2f.Platform?_2f.Platform.toLowerCase():null;this.Platform=!_2f.Platform||_2f.Platform===this.PLATFORM_AUTO?this._DetectPlatform():_2f.Platform;switch(this.Platform){case this.PLATFORM_DESKTOP:this.LibFiles=[this.GetFileUrl("ITHitAJAXFileBrowser.js"),this.GetThemeFileUrl("desktop.css"),this.GetThemeFileUrl("icons_"+this.IconsSize+".css")];break;case this.PLATFORM_MOBILE:case this.PLATFORM_TABLET:this.LibFiles=[this.GetFileUrl("ITHitAJAXFileBrowserMobile.js"),this.GetThemeFileUrl("mobile.css")];break;default:throw new Error("Wrong platform type `"+this.Platform+"`. Available types: `auto`, `desktop`, `tablet`, `mobile`.");}this._HeadItemsLoader=null;this._ContentItemsLoader=null;this._HasError=false;this.UI=new _3(this,_2f.Id);};_2e.prototype={DEFAULT_THEME:"windows_8",DEFAULT_ICONS_SIZE:16,PLATFORM_AUTO:"auto",PLATFORM_DESKTOP:"desktop",PLATFORM_TABLET:"tablet",PLATFORM_MOBILE:"mobile",CALCULATE_BY_SIZE:"size",CALCULATE_BY_FILES_COUNT:"files_count",CALCULATE_BY_FILES_WHEN_IT_MORE:5,onload:null,oninit:null,LoadAsync:function(){var _30=this;var _31=this.GetThemeFileUrl("loader.css");var _32=new _e(this._AppendTimeToUrl(_31,(new Date()).getTime()),"HEAD");_32.onload=function(){var _33=_32.StatusData.LastModified;var _34=_33?(new Date(_33)).getTime():(new Date(_33)).getTime();var _35=new _e(_30._AppendTimeToUrl(_31,_34));_35.onload=function(_36){_30._InsertStyle(_36);_30.UI.Render();_30._LoadLib();};_35.Load();};_32.Load();},GetFolderUrl:function(_37){_37=_37||"";_37=_37.replace(/\/+$/,"")+"/";return this.GetFileUrl(_37);},GetFileUrl:function(_38){_38=_38||"";if(_38.indexOf("://")!==-1||_38.indexOf("/")===0){return _38;}return this.BasePath+_38;},GetThemeFolderUrl:function(){return this.GetFolderUrl(this.ThemesPath+this.ThemeName);},GetThemeFileUrl:function(_39){return this.GetFileUrl(this.ThemesPath+this.ThemeName+(_39?"/"+_39:""));},_LoadLib:function(){var _3a=this;var _3b=[];for(var i=0,l=this.LibFiles.length;i<l;i++){_3b.push(this._AppendTimeToUrl(this.LibFiles[i],(new Date()).getTime()));}this._HeadItemsLoader=new _24(_3b,"HEAD");this._HeadItemsLoader.onerror=function(_3c,_3d){_3a.UI.UpdateStatusText(_3d);};this._HeadItemsLoader.onloadall=function(){_3a._LoadLibContent();};this._HeadItemsLoader.Load();},_LoadLibContent:function(){var _3e=this;var _3f=[];for(var i=0,l=this.LibFiles.length;i<l;i++){var _40=this._HeadItemsLoader.Items[i].StatusData.LastModified;var _41=_40?(new Date(_40)).getTime():(new Date(_40)).getTime();_3f.push(this._AppendTimeToUrl(this.LibFiles[i],_41));}this._ContentItemsLoader=new _24(_3f,"GET");this._ContentItemsLoader.onerror=function(_42,_43){_3e.UI.UpdateStatusText(_43);};this._ContentItemsLoader.onprogress=function(){_3e._ProcessItemHandler();};this._ContentItemsLoader.onloadall=function(){_3e._AllLoadHandler();};this._ContentItemsLoader.Load();},_AppendTimeToUrl:function(_44,_45){var _46=_45.toString();var _47=(window.location.protocol==="https:"?"s":"")+window.location.hostname+window.location.port;_46+="_"+encodeURIComponent(_47);return this._AppendUrlParam(_44,"t",_46);},_AppendUrlParam:function(_48,key,_49){return _48+((-1==_48.indexOf("?"))?"?":"&")+encodeURIComponent(key)+"="+encodeURIComponent(_49);},_ProcessItemHandler:function(){var _4a=0;var _4b=0;for(var i=0,l=this.LibFiles.length;i<l;i++){var _4c=this._ContentItemsLoader.Items[i];var _4d=this._HeadItemsLoader.Items[i];if(!_4d.StatusData.TotalLength){continue;}_4a+=_4c.StatusData.LoadedLength;_4b+=_4d.StatusData.TotalLength;}this.UI.LoadedSize=_4a;this.UI.TotalSize=_4b;this.UI.Percent=Math.round(_4a*100/_4b);this.UI.Render();},_AllLoadHandler:function(){this.UI.Destroy();for(var i=0,l=this._ContentItemsLoader.Items.length;i<l;i++){var _4e=this._ContentItemsLoader.Items[i];switch(_4e.FileExtension){case "js":this._InsertJavaScript(_4e.Data);break;case "css":this._InsertStyle(_4e.Data);break;default:throw new Error("Can not detect format for file `"+_4e.Url+"`");}}if(typeof this.onload==="function"){this.onload();}var _4f=this.Platform===this.PLATFORM_DESKTOP?new ITHit.WebDAV.Client.AjaxFileBrowser.Controller(this.Settings):new ITHit.WebDAV.Client.AjaxFileBrowserMobile.Controller(this.Settings);var _50=this;ITHit.Events.AddListener(_4f,"OnInit",function(){if(typeof _50.oninit==="function"){_50.oninit(_4f);}});},_InsertJavaScript:function(_51){if(!_51){return;}var _52=document.getElementsByTagName("HEAD").item(0);var _53=document.createElement("script");_53.language="javascript";_53.type="text/javascript";_53.id=this.SCRIPT_ID;_53.defer=true;_53.text=_51;_52.appendChild(_53);},_InsertStyle:function(_54){if(!_54){return;}_54=_54.replace(/url\(('|")?([^'"d][^'")]+)('|")?\)?/g,"url("+this.GetThemeFolderUrl()+"$2)");var css=document.createElement("style");css.type="text/css";if(css.styleSheet){css.styleSheet.cssText=_54;}else{css.appendChild(document.createTextNode(_54));}document.getElementsByTagName("head")[0].appendChild(css);},_DetectPlatform:function(){var _55=navigator.userAgent.toLowerCase();if(/ipad/i.test(_55)){return this.PLATFORM_TABLET;}if(/iphone|ipod|meego|webos|iemobile|opera mini/i.test(_55)){return this.PLATFORM_MOBILE;}if(/android/i.test(_55)){return /mobile/i.test(_55)?this.PLATFORM_MOBILE:this.PLATFORM_TABLET;}if(/blackberry|bb10|rim/i.test(_55)){return /tablet/i.test(_55)?this.PLATFORM_TABLET:this.PLATFORM_MOBILE;}if(/windows/i.test(_55)){if(/phone/i.test(_55)){return this.PLATFORM_MOBILE;}if(/touch/i.test(_55)){return this.PLATFORM_TABLET;}}if(/\(mobile;|\(tablet;|; rv:/i.test(_55)){if(/mobile/i.test(_55)){return this.PLATFORM_MOBILE;}if(/tablet/i.test(_55)){return this.PLATFORM_TABLET;}}return this.PLATFORM_DESKTOP;}};this.ITHit=this.ITHit||{};this.ITHit.WebDAV=this.ITHit.WebDAV||{};this.ITHit.WebDAV.Client=this.ITHit.WebDAV.Client||{};this.ITHit.WebDAV.Client.AjaxFileBrowserLoader=_2e;this.ITHit.WebDAV.Client.AjaxFileBrowser=this.ITHit.WebDAV.Client.AjaxFileBrowser||{};this.ITHit.WebDAV.Client.AjaxFileBrowser.Render=this.ITHit.WebDAV.Client.AjaxFileBrowser.Render||{};this.ITHit.WebDAV.Client.AjaxFileBrowser.Render.ViewModes={Details:"details",Medium:"medium",Large:"large",ExtraLarge:"extralarge"};})();